function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var o=0;o<r.length;o++){var t=r[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,o,t){return o&&e(r.prototype,o),t&&e(r,t),r}}();"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,r){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),t=1;t<arguments.length;t++){var c=arguments[t];if(null!=c)for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(o[a]=c[a])}return o},writable:!0,configurable:!0}),Object.entries||(Object.entries=function(e){for(var r=Object.keys(e),o=r.length,t=new Array(o);o--;)t[o]=[r[o],e[r[o]]];return t}),Array.from||(Array.from=function(){var e=Object.prototype.toString,r=function(r){return"function"==typeof r||"[object Function]"===e.call(r)},o=function(e){var r=Number(e);return isNaN(r)?0:0!==r&&isFinite(r)?(r>0?1:-1)*Math.floor(Math.abs(r)):r},t=Math.pow(2,53)-1,c=function(e){var r=o(e);return Math.min(Math.max(r,0),t)};return function(e){var o=this,t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var a,n=arguments.length>1?arguments[1]:void 0;if(void 0!==n){if(!r(n))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(a=arguments[2])}for(var i,p=c(t.length),s=r(o)?Object(new o(p)):new Array(p),l=0;l<p;)i=t[l],s[l]=n?void 0===a?n(i,l):n.call(a,i,l):i,l+=1;return s.length=p,s}}()),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,r){r=r||window;for(var o=0;o<this.length;o++)e.call(r,this[o],o,this)});var CcmLog=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"log",value:function(e){var r=!0;if(void 0!==ccmWrapper.config.log.log&&(r=ccmWrapper.config.log.log),r)try{for(var o=arguments.length,t=Array(o>1?o-1:0),c=1;c<o;c++)t[c-1]=arguments[c];if(t.length>0){var a;(a=console).log.apply(a,[e].concat(t))}else console.log(e)}catch(e){}}},{key:"info",value:function(r){var o=!0;if(void 0!==ccmWrapper.config.log.info&&(o=ccmWrapper.config.log.info),o){for(var t=arguments.length,c=Array(t>1?t-1:0),a=1;a<t;a++)c[a-1]=arguments[a];try{if(c.length>0){var n;(n=console).info.apply(n,[r].concat(c))}else console.info(r)}catch(o){e.error(o),e.log.apply(e,[r].concat(c))}}}},{key:"debug",value:function(r){var o=!0;if(void 0!==ccmWrapper.config.log.debug&&(o=ccmWrapper.config.log.debug),o){for(var t=arguments.length,c=Array(t>1?t-1:0),a=1;a<t;a++)c[a-1]=arguments[a];try{if(c.length>0){var n;(n=console).debug.apply(n,[r].concat(c))}else console.debug(r)}catch(o){e.error(o),e.log.apply(e,[r].concat(c))}}}},{key:"warning",value:function(r){var o=!0;if(void 0!==ccmWrapper.config.log.warning&&(o=ccmWrapper.config.log.warning),o){for(var t=arguments.length,c=Array(t>1?t-1:0),a=1;a<t;a++)c[a-1]=arguments[a];try{if(c.length>0){var n;(n=console).warn.apply(n,[r].concat(c))}else console.warn(r)}catch(o){e.error(o),e.log.apply(e,[r].concat(c))}}}},{key:"error",value:function(r){var o=!0;if(void 0!==ccmWrapper.config.log.error&&(o=ccmWrapper.config.log.error),o){for(var t=arguments.length,c=Array(t>1?t-1:0),a=1;a<t;a++)c[a-1]=arguments[a];try{if(c.length>0){var n;(n=console).error.apply(n,[r].concat(c))}else console.error(r)}catch(o){e.error(o),e.log.apply(e,[r].concat(c))}}}}]),e}(),CcmCookie=function(){function e(r){_classCallCheck(this,e),this.isSet=!1,this.name=r,this.value=null,this.domain=ccmWrapper.config.cookieDomain,this.path=ccmWrapper.config.cookiePath,this.expires=new Date,this.expires.setTime(this.expires.getTime()+31536e6),this.read()}return _createClass(e,[{key:"read",value:function(){var e=document.cookie.match("(^|;) ?"+this.name+"=([^;]*)(;|$)");e&&(this.value=e[2],this.isSet=!0,CcmLog.debug("Loaded cookie: "+this.name,this,document.cookie))}},{key:"store",value:function(){var e=[this.name+"="+this.value,"expires="+this.expires.toUTCString()];this.domain&&e.push("domain="+this.domain),this.path&&e.push("path="+this.path),document.cookie=e.join(";"),this.isSet?CcmLog.debug("Stored cookie: "+this.name,this,document.cookie):CcmLog.debug("Created cookie: "+this.name,this,document.cookie),this.isSet=!0}},{key:"delete",value:function(){this.isSet&&(this.value=null,this.expires=new Date(0),this.store(),this.isSet=!1,CcmLog.debug("Deleted cookie: "+this.name,document.cookie))}}]),e}(),Wrapper=function(){function e(){_classCallCheck(this,e),this.config={log:{log:!1,info:!1,debug:!1,warning:!1,error:!1},organisation:"NPO",site:"nporadio2.nl",cookieDomain:".nporadio2.nl",cookiePath:"/",wrapperCacheCookieName:"CCM_Wrapper_Cache",assetsBaseUrl:"https://ccm.npo.nl",ccmSettingsBaseUrl:"https://cookies.nporadio2.nl",ccmScript:"ccm_",ccmAutoLoad:!0,XMLHttpRequestTimeout:8e3,executed:!1},this.dispatchEvent("CCM_Wrapper_loaded")}return _createClass(e,[{key:"preprocess",value:function(){"complete"===document.readyState||"loaded"===document.readyState||"interactive"===document.readyState?ccmWrapper.dispatchEvent("CCM_Wrapper_ready"):document.onreadystatechange=function(){"complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState||ccmWrapper.dispatchEvent("CCM_Wrapper_ready")}}},{key:"init",value:function(e){if(ccmWrapper.config.executed)return!1;if(ccmWrapper.config.executed=!0,CcmLog.info("Running init()"),e&&(CcmLog.debug("Init contains an overruling config",e),ccmWrapper.config=Object.assign(ccmWrapper.config,e),CcmLog.debug("New wrapper config",ccmWrapper.config)),ccmWrapper.WrapperCacheCookie=new CcmCookie(ccmWrapper.config.wrapperCacheCookieName),ccmWrapper.WrapperCacheCookie.isSet)CcmLog.info("Loading existing CCM Wrapper cache cookie"),ccmWrapper.processWrapperData(),ccmWrapper.loadCCM();else{CcmLog.info("Getting wrapper version data");var r=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");r.open("GET",ccmWrapper.config.assetsBaseUrl+"/sites/"+ccmWrapper.config.organisation+"/"+ccmWrapper.config.site+"/version.txt",!0),r.timeout=ccmWrapper.config.XMLHttpRequestTimeout,r.onreadystatechange=function(){if(CcmLog.debug("XHR ready state changed",r),4==r.readyState){if(200!=r.status)throw CcmLog.error("Received HTTP status code "+r.status+" on requesting CCM Wrapper data",r),"exit";CcmLog.debug("Fetched wrapper data",r.responseText),ccmWrapper.WrapperCacheCookie.value=btoa(r.responseText),ccmWrapper.WrapperCacheCookie.domain=ccmWrapper.config.cookieDomain,ccmWrapper.WrapperCacheCookie.path=ccmWrapper.config.cookiePath,ccmWrapper.WrapperCacheCookie.expires=new Date,ccmWrapper.WrapperCacheCookie.expires.setTime(ccmWrapper.WrapperCacheCookie.expires.getTime()+36e5),ccmWrapper.WrapperCacheCookie.store(),ccmWrapper.processWrapperData(JSON.parse(r.responseText)),ccmWrapper.loadCCM()}},r.onerror=function(e){throw CcmLog.error("Error on requesting CCM Wrapper data",e),"exit"},r.ontimeout=function(e){throw CcmLog.error("Timeout on requesting CCM Wrapper data",e),"exit"},r.send()}ccmWrapper.config.ccmAutoLoad&&window.addEventListener("CCM_ready",function(e){CcmLog.info("Autoloading CCM"),ccm.init()},!1)}},{key:"processWrapperData",value:function(e){if(!e)try{e=JSON.parse(atob(ccmWrapper.WrapperCacheCookie.value))}catch(e){throw CcmLog.error("Could not load cached wrapper data",ccmWrapper.WrapperCacheCookie.value,atob(ccmWrapper.WrapperCacheCookie.value)),ccmWrapper.WrapperCacheCookie.delete(),"exit"}CcmLog.log("CCM Wrapper cache",e),ccmWrapper.version=e.ver,ccmWrapper.jsHash=e.jsh,ccmWrapper.cookieId=e.cid,ccmWrapper.contentId=e.conid}},{key:"loadCCM",value:function(){var e=ccmWrapper.createScript(ccmWrapper.config.assetsBaseUrl+"/sites/"+ccmWrapper.config.organisation+"/"+ccmWrapper.config.site+"/"+ccmWrapper.config.ccmScript+ccmWrapper.version+"-"+ccmWrapper.contentId+".js"),r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(e,r),ccmWrapper.dispatchEvent("CCM_Wrapper_done")}},{key:"dispatchEvent",value:function(e){try{var r=void 0;"function"==typeof window.CustomEvent?r=new Event(e):(r=document.createEvent("HTMLEvents"),r.initEvent(e,!1,!0)),window.dispatchEvent(r)}catch(e){CcmLog.error(e)}}},{key:"createScript",value:function(e,r,o){var t=document.createElement("script");return t.src=e,t.crossOrigin="anonymous",o&&(t.integrity=o),r&&(t.async=r,t.defer=r),t}},{key:"createStyle",value:function(e,r,o){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t.crossOrigin="anonymous",o&&(t.integrity=o),r&&(t.async=r,t.defer=r),t}}]),e}(),ccmWrapper;ccmWrapper=new Wrapper,CcmLog.debug("Wrapper config",ccmWrapper.config),ccmWrapper.preprocess();